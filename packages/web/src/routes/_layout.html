<script context="module">
	export async function preload({ query, params }) {
		const response = await this.fetch('/version')
		const version = (await response.text()).trim()
		return {
			version
		}
	}
</script>

<script>
	import { stores } from '@sapper/app'
	import { _style } from '@ctx-core/html'
	import { _has__dom, _no__dom, _BoundingClientRect } from '@ctx-core/dom'
	import { andand, tick } from '@ctx-core/function'
	import { _html__webfont__fout, _html__gtag } from '@ctx-core/google/html'
	import { __VERSION } from '@ctx-core/env/store'
	import { __session__sapper, __preloading__sapper, __page__sapper, __path__sapper } from '@ctx-core/sapper/store'
	import { __title, __class__layout } from '@briantakita/web/src/layout/store'
	import { __prepend__footer } from '@briantakita/web/src/layout/store'
	import Header from '@briantakita/web/src/layout/Header.html'
	import Footer from '@briantakita/web/src/layout/Footer.html'
	import { hljs } from '../highlight.js/lib'
	import { refresh__initHighlighting } from '@ctx-core/highlight.js'
	const { page, preloading, session } = stores()
	export let version
	let dom__container__Header
	let height__container__Header
	let css__height__container__Header
	let style__layout
	let style__container__Header
	__VERSION.set(version)
	$: __page__sapper.set($page)
	$: __preloading__sapper.set($preloading)
	$: __session__sapper.set($session)
	$: height__container__Header =
		dom__container__Header
		&& _BoundingClientRect(dom__container__Header).height
	$: css__height__container__Header = `${height__container__Header}px`
	$: style__layout = _style({ 'padding-top': css__height__container__Header })
	$: style__container__Header = _style({ height: css__height__container__Header })
	$: __page__sapper.set($page)
	$: {
		$page
		__prepend__footer.set('')
		refresh__initHighlighting(hljs)
	}
</script>

<svelte:head>
	<title>{$__title ? `${$__title} â€” ` : ''}BrianTakita.com</title>
</svelte:head>

{#if _no__dom()}
{@html _html__webfont__fout({ families: ['Open Sans'] })}
{/if}

<div
	{version}
	class="_layout {$__class__layout||''}"
	style="{style__layout}"
>
	<div
		bind:this="{dom__container__Header}"
		class="container__Header"
		class:fixed="{height__container__Header}"
		style="{style__container__Header}"
	>
		<Header></Header>
	</div>

	<main class="content">
		<div class="content-wrap" tabindex="0">
			<slot></slot>
		</div>
		<Footer></Footer>
	</main>
</div>

{#if _no__dom()}
{@html _html__gtag()}
{/if}

<style type="text/scss" @lang="sass">
	@import '~@briantakita/web/src/css/variables';
	:global(*) {
		@import '~highlight.js/styles/dracula';
	}
	:global(*) {
		box-sizing: border-box;
	}
	:global(html) {
		opacity: 0;
		&.wf-active {
			opacity: 1;
		}
	}
	:global(body) {
		font-family: 'Open Sans', arial, sans-serif;
		font-size: 21px;
		line-height: 1.52;
		background-color: $color__body;
		text-rendering: optimizeLegibility;
		-webkit-font-smoothing: antialiased;
		color: $color__text;
		@media (min-width: 1600px) {
			font-size: 26px;
		}
		@media (max-width: 900px) {
			font-size: 18px;
		}
	}
	:global(body, a) {
		color: $color__text;
	}
	:global(.content-wrap) {
		width: 100%;
		margin: 0 auto;
		padding: 0 1em;
		@media (min-width: $width__nav__slider) {
			width: 60rem;
			padding: 0;
		}
	}
	:global(h1, h2, h3, h4, h5, h6, p, body, a, img, blockquote, pre) {
		margin: 0;
		padding: 0;
		border: 0;
	}
	:global(h1) {
		font-size: 2em;
		margin-bottom: 1em;
		text-align: center;
	}
	:global(h2) {
		font-size: 1.6em;
		font-weight: 400;
		line-height: 1.43;
	}
	:global(h3) {
		font-style: italic;
		font-weight: 400;
		font-size: 1.4em;
		margin-top: 1.8em;
		margin-bottom: 0.8em;
	}
	:global(blockquote) {
		margin: 1.2em 3em;
		padding-left: 1em;
		font-style: italic;
	}
	:global(hr) {
		border: 0;
		border-top: 1px dashed #d2d2d2;
		height: 0;
		margin: 1.6em 0;
	}
	:global(iframe) {
		display: block;
		margin: 0 auto;
	}
	:global(p, ul) {
		margin-bottom: 1.52em;
	}
	:global(a) {
		&:hover {
			text-decoration: underline;
		}
	}
	:global(header) {
		border-top: 1px dashed #d2d2d2;
		margin: 0.7rem 0 0;
		:global(h2) {
			font-style: italic;
			text-align: center;
			font-weight: 400;
			margin: 0.8em 0;
			font-size: 1.4em;
			:global(a) {
				text-decoration: none;
			}
		}
		:global(.date) {
			text-align: center;
			font-size: 0.8em;
			margin-top: -0.7em;
			text-rendering: auto;
			letter-spacing: 1px;
			font-variant: small-caps;
			text-transform: lowercase;
			font-weight: 400;
			:global(span) {
				background-color: $color__highlight__text;
				padding: 0 0.7em;
			}
		}
	}
	:global(.post) {
		margin: 2rem 0 4rem;
		:global(hr.more) {
			display: none;
		}
		:global(code) {
			font-family: 'Anonymous Pro', monospace;
			font-size: 0.85em;
			/*color: #000;*/
			&.lang-markdown {
				color: #424242;
				.header, .strong {
					font-weight: bold;
				}
				&.emphasis {
					font-style: italic;
				}
				.horizontal_rule, .link_label, .code, .header, .link_url {
					color: #555;
				}
				.blockquote, .bullet {
					color: #bbb;
				}
			}
		}
		:global(pre) {
			font-size: 0.9em;
			overflow: auto;
			border: 1px dashed #d2d2d2;
			border-radius: 0.25em;
			margin-bottom: 1.8em;
			padding: 1em;
			:global(code) {
				display: block;
				line-height: 1.1;
			}
		}
		:global(p) {
			:global(code) {
				padding: 0.1em 0.3em 0.2em;
				border-radius: 0.3em;
				position: relative;
				top: -0.15em;
				background: #444;
				color: #fff;
				white-space: nowrap;
			}
		}
	}
	:global(img) {
		width: 100%;
	}
	._layout {
		position: relative;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		.container__Header {
			flex: 0;
			z-index: 1;
			&.fixed {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
			}
		}
		main {
			flex: 1;
			position: relative;
			display: flex;
			flex-direction: column;
			overflow: auto;
			min-height: 600px;
			width: 100%;
			padding: 0;
			margin: 0 auto;
			box-sizing: border-box;
			z-index: 0;
		}
	}
	:global(.post) {
		margin: 1em 0 2.5em;
	}
</style>
