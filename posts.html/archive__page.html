<Layout>
  <section class="archive">
    <h2>Archive</h2>
    <ul>
      {{#each years as year, i}}
        <li class="year">
          <span
            style="line-height: {{height(posts__years[year])}}em;"
            class="year-label {last(years, i) ? 'last' : ''}"
          >{year}</span>
          <ul>
            {{#each Object.keys(posts__years__months[year]) as month, j}}
              <li
                class="month"
                style="height: {{height(posts__years__months[year][month])}};"
              >
                <span
                  style="line-height: {{height(posts__years__months[year][month])}};"
                  class="month-label {{last(posts__years__months[year], j) ? 'last' : ''}}"
                >{{month}}</span>
                {{#each posts__years__months[year][month] as post, k}}
                  <a href="{{post.url}}"
                     style="line-height: {{height(posts__years__months[year][month])}}em;"
                     class="{{last(posts__years__months[year][month], k) ? 'last' : ''}}"
                  >post.title</a>
                {{/each}}
              </li>
            {{/each}}
          </ul>
        </li>
      {{/each}}
    </ul>
  </section>
</Layout>
<script type="text/babel">
  import Layout from 'layout/layout.html'
  import PostIntro from 'posts.html/post_intro.html'
  const lineHeight = 2.2
  export default {
    helpers: {
      last: (list, i) =>
        list.length - 1 == i,
      height: posts =>
        lineHeight * posts.length
    },
    computed: {
      posts__years: posts => {
        const _posts__years = {}
        for (let i=posts.length-1; i; i--) {
          const post = posts[i]
              , year = post.date.getFullYear()
          _posts__years[year] = _posts__years[year] || []
          _posts__years[year].push(post)
        }
        return _posts__years
      },
      posts__years__months: posts__years => {
        const _posts__years__months = {}
        for (let year in posts__years) {
          const posts__months =
                  _posts__years__months[year] || {}
          _posts__years__months[year] = posts__months
          const posts__year = posts__years[year]
          for (let i=0; i < posts__year.length; i++) {
            const post = posts__year[i]
                , month = post.date.getMonth()
                , posts__month =
                    posts__months[month] || []
            posts__months[month] = posts__month
            posts__month.push(post)
          }
        }
        return _posts__years__months
      },
      years: posts__years => {
        return Object.keys(posts__years)
      }
    },
    components: {
      Layout,
      PostIntro
    }
  }
</script>